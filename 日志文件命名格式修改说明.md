# 日志文件命名格式修改说明

## 修改概述

将日志文件的命名格式从`{用例ID}_{轮次}.log`修改为`{用例编号}_{轮次}.log`，使日志文件名更加直观和易读。

## 修改内容

### 1. 方法签名修改

#### executePythonScript方法
```java
// 修改前
public static PythonExecutionResult executePythonScript(Path scriptPath, Long testCaseId, Integer round, Integer timeoutMinutes, String goHttpServerUrl)

// 修改后
public static PythonExecutionResult executePythonScript(Path scriptPath, Long testCaseId, String testCaseNumber, Integer round, Integer timeoutMinutes, String goHttpServerUrl)
```

#### startPythonProcess方法
```java
// 修改前
public static Process startPythonProcess(Path scriptPath, Long testCaseId, Integer round, String goHttpServerUrl)

// 修改后
public static Process startPythonProcess(Path scriptPath, Long testCaseId, String testCaseNumber, Integer round, String goHttpServerUrl)
```

### 2. 日志文件命名逻辑

#### 新的命名逻辑
```java
// 创建日志文件路径 - 使用用例编号_轮次.log格式
String logFileName;
if (testCaseNumber != null && !testCaseNumber.trim().isEmpty()) {
    logFileName = String.format("%s_%d.log", testCaseNumber, round);
} else {
    // 如果没有用例编号，则使用用例ID
    logFileName = String.format("%d_%d.log", testCaseId, round);
}
Path logFilePath = logsDir.resolve(logFileName);
```

#### 命名规则
- **优先使用用例编号**: 如果提供了用例编号，使用`{用例编号}_{轮次}.log`格式
- **降级使用用例ID**: 如果没有用例编号，则使用`{用例ID}_{轮次}.log`格式

### 3. 调用方式修改

#### TestCaseExecutionServiceImpl
```java
// 修改前
PythonExecutorUtil.executePythonScript(scriptPath, testCase.getTestCaseId(), testCase.getRound(), timeoutMinutes, request.getLogReportUrl());

// 修改后
PythonExecutorUtil.executePythonScript(scriptPath, testCase.getTestCaseId(), testCase.getTestCaseNumber(), testCase.getRound(), timeoutMinutes, request.getLogReportUrl());
```

## 命名示例

### 1. 使用用例编号的命名
```
TC001_1.log    // 用例编号TC001，第1轮
TC002_2.log    // 用例编号TC002，第2轮
4G_Network_Connection_Test_1.log  // 用例编号4G_Network_Connection_Test，第1轮
```

### 2. 降级使用用例ID的命名
```
1_1.log        // 用例ID为1，第1轮
2_3.log        // 用例ID为2，第3轮
```

## 文件存储位置

### 日志文件存储目录
```
CaseExecuteService/logs/
├── TC001_1.log
├── TC002_1.log
├── TC002_2.log
├── 4G_Network_Connection_Test_1.log
└── ...
```

### 上传到gohttpserver后的URL
```
http://localhost:8000/upload/TC001_1.log
http://localhost:8000/upload/TC002_2.log
http://localhost:8000/upload/4G_Network_Connection_Test_1.log
```

## 兼容性说明

### 1. 向后兼容
- 如果没有提供用例编号，系统会自动降级使用用例ID
- 现有的调用方式仍然可以正常工作

### 2. 参数传递
- 新增的`testCaseNumber`参数为可选参数
- 如果传入null或空字符串，会使用用例ID作为文件名

### 3. 数据库存储
- `logFilePath`字段存储的是完整的文件路径或HTTP链接
- 支持新的命名格式，无需修改数据库结构

## 测试验证

### 1. 测试脚本
```bash
# 运行测试脚本
python3 test_log_naming.py
```

### 2. 验证步骤
1. 检查logs目录中的文件命名格式
2. 确认文件名使用用例编号而不是用例ID
3. 验证gohttpserver中的文件命名
4. 检查数据库中的logFilePath字段

### 3. 预期结果
- 日志文件名格式：`{用例编号}_{轮次}.log`
- 文件内容正确记录
- 上传到gohttpserver的URL正确

## 注意事项

1. **用例编号格式**: 用例编号可能包含特殊字符，系统会直接使用，不做特殊处理
2. **文件冲突**: 如果同一用例编号和轮次多次执行，会覆盖之前的日志文件
3. **路径长度**: 确保用例编号不会导致文件路径过长
4. **特殊字符**: 用例编号中的特殊字符在文件系统中是安全的

## 相关文件

### 修改的文件
- `PythonExecutorUtil.java`: 核心执行逻辑和文件命名
- `TestCaseExecutionServiceImpl.java`: 调用方式修改

### 测试文件
- `test_log_naming.py`: 测试脚本
- `logs/`: 日志文件存储目录

### 文档
- `日志文件命名格式修改说明.md`: 本文档
